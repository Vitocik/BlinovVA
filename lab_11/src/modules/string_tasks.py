"""
Модуль решает три типовые задачи обработки строк с
использованием продвинутых алгоритмов поиска:

1) Поиск всех вхождений паттерна в текст — с помощью KMP,
Z-функции и Рабина-Карпа.
2) Определение минимального периода строки (если строка периодична).
3) Проверка, является ли одна строка циклическим сдвигом другой.

Использует реализации алгоритмов из пользовательских модулей:
- kmp_search
- prefix_function
- rabin_karp
- string_matching (z_search)
"""


from typing import Dict, List, Optional

from kmp_search import kmp_search
from prefix_function import prefix_function
from rabin_karp import rabin_karp
from string_matching import z_search


def find_all_occurrences(text: str, pattern: str) -> Dict[str, List[int]]:
    """
    Находит все стартовые индексы вхождения паттерна в текст,
    используя несколько алгоритмов.

    Аргументы:
        text (str): Текст, в котором выполняется поиск.
        pattern (str): Паттерн, который нужно найти.

    Возвращает:
        Dict[str, List[int]]: Словарь, где ключ — название
        алгоритма ("kmp", "z", "rk"),
                              значение — список индексов,
                              с которых начинается паттерн.

    Примечания:
        - Все алгоритмы возвращают одинаковые индексы
        при корректной реализации.
        - Порядок индексов — по возрастанию.
        - Если паттерн не найден, возвращается пустой список
        для каждого метода.
    """
    return {
        "kmp": kmp_search(text, pattern),
        "z": z_search(text, pattern),
        "rk": rabin_karp(text, pattern),
    }


def string_period(s: str) -> Optional[int]:
    """
    Определяет минимальный период строки, если он существует.

    Строка s имеет период p, если s может быть представлена
    как повторение подстроки длины p.
    Например: "abcabc" имеет период 3 ("abc").

    Аргументы:
        s (str): Входная строка.

    Возвращает:
        Optional[int]: Длина минимального периода,
        если строка периодична; иначе None.

    Особенности:
        - Пустая строка возвращает None.
        - Строка из одного символа имеет период 1.
        - Использует префикс-функцию: если длина
        строки n делится на p = n - pi[n-1] и p < n,
          то p — минимальный период.

    Сложность: O(n)
    """
    if not s:
        return None

    pi = prefix_function(s)
    n = len(s)
    p = n - pi[-1]  # потенциальный период

    if p < n and n % p == 0:
        return p

    return None


def is_rotation(a: str, b: str) -> bool:
    """
    Проверяет, является ли строка b циклическим сдвигом строки a.

    Циклический сдвиг — это перестановка, при которой
    часть строки переносится с начала в конец.
    Например: "abc" → "bca" → "cab" → "abc".

    Аргументы:
        a (str): Исходная строка.
        b (str): Проверяемая строка.

    Возвращает:
        bool: True, если b — циклический сдвиг a; иначе False.

    Логика:
        b является циклическим сдвигом a тогда и только тогда,
        когда b является подстрокой a + a.
        Например: a = "abc", a + a = "abcabc",
        b = "bca" → "bca" in "abcabc" → True.

    Условия:
        - Если длины строк не совпадают, возвращается False.
        - Пустые строки считаются циклическим сдвигом друг друга.

    Сложность: O(n), где n — длина строки.
    """
    if len(a) != len(b):
        return False

    return b in (a + a)
